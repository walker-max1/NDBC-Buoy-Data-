---
title: "Exploring Ocean Buoy Data"
author: "Max Walker"
date: "4/21/2020"
output:
  html_document:
    df_print: kable
subtitle: 'Part 2: Wave and Weather Data from NDBC Station 46087'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(dplyr)
library(lubridate)
library(knitr)
library(rmarkdown)
library(gridExtra)
library(ggpubr)
library(kableExtra)
library(formattable)

setwd('C:/Users/walke/Documents/Wave Project')

```

# Project Outline
  
This report is Part 2 in a five part series in which we are exploring and analyzing ocean buoy data collected from NOAA maintained National Data Buoy Center (NDBC) stations.  In **Part 1** we explored ocean current observations at the NDBC Station 46087 (Neah Bay Buoy) and compared them with ocean current forecasts from a third party.  Here in **Part 2** we will look at meteorological (wind and wave) data from the Neah Bay Buoy and examined the potential for significant meteorological events to introduce noise in ocean current observations.  In **Part 3** we will introduce meteorological data for another location, NDBC Station 46088 (New Dungeness Buoy), and compare trends in wave height, period, and direction with those of the Neah Bay Buoy.  We will attempt to highlight the relationship between swell events at the Neah Bay Buoy and swell events at the New Dungeness Buoy.  In **Part 4** we will walk through considerations and processes involved in training and testing a supervised ML model to predict the class of wave which might occur at the New Dungeness Buoy given conditions at the Neah Bay Buoy.  In **Part 5** we will put our final classifier model in production by supplying forecasted conditions for the Neah Bay Station and determining the predicted class of wave observed at the New Dungeness Station.  

More detailed information regarding the NDBC, and the locations of buoys they maintain, can be found on their [website](https://www.ndbc.noaa.gov/).  



## Executive Summary: Part 2

In this report, we introduce meteorological data collected from NDBC Station 46087 (Neah Bay Bouy) at the West entrance to the Strait of Juan de Fuca.  We explore summary statistics for mean aggregate values, noting seasonal trends in observations.

Then we introduce time series data visualization and gain further insight into seasonal trends for wind and wave data over years 2014 to 2019.  We take a closer look at monthly observations for year 2016, where individual spikes in wave height, or 'swell events', become apparent.

Finally, we wrap up the data exploration by comparing instances of 'erratic' and 'dampened' ocean current observations, similar to those identified in Part 1 of this project, with meteorological data along the same timeline.  We explore the elevated water temperatures during 2016, and their potential relation to increased marine growth.  We conclude that the ocean current predictions are a fair and valid representation of how we could expect ocean current observations to behave in the absence of strong meteorological events ('wind events', 'wave events', etc).  


```{r load data, include=FALSE }
setwd("C:/Users/walke/Documents/Wave Project/Waves NB/Historical Wave Data")

#load data
data <- read.csv('historical_46087_04_19.csv')

swell <- data %>% select(id, Date_Time, WVHT, MWD, dir, swell_type, DPD, APD, WDIR, w_dir, WSPD, GST, PRES, ATMP, WTMP, DEWP)

#change to factors
swell$id <- as.factor(swell$id)

swell$swell_type <- factor(swell$swell_type, levels = c('groundswell', 'windswell', 'windwave', 'chop', 'flat'))

#change dir level to be in order clockwise starting at E
levels <- c('E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW', 'N',
            'NNE', 'NE', 'ENE')

swell$dir <- factor(swell$dir, levels = levels)

swell$w_dir <- factor(swell$w_dir, levels = levels)

#change Date_Time to POSIXct timezone = 'GMT'
swell$Date_Time <- ymd_hms(swell$Date_Time)
swell$Date_Time <- as.POSIXct(swell$Date_Time, tz = 'GMT')
```


## Data
The data we will be exploring is available for download in nicely formatted, yearly '.txt' files from the NDBC website [here](https://www.ndbc.noaa.gov/station_page.php?station=46087).  There are a significant number of missing observations, with the range of available data spanning from 2004 through 2019.  After compiling each year into a single dataset and performing routine data cleaning steps, I chose to engineer several new features. A formal definition and description of each feature is available in the appendix of this report, and details regarding measurement techniques utilized by the NDBC can be found [here](https://www.ndbc.noaa.gov/measdes.shtml).



## Exploring Meteorological and Swell Data

Before we dive deep into the granularity of the data, I believe it is important to obtain a better understanding of what data is present.  We can do this by aggregating data for all months to obtain monthly averages:

```{r summary stats, include=FALSE}
# summary statistics
#by year
summaryYEAR<- swell %>% 
  group_by(year(Date_Time)) %>%
  summarise(n = n(),
            mean_wvdir = mean(MWD, na.rm = TRUE),
            mean_wvht = mean(WVHT, na.rm = TRUE),
            mean_AvgPeriod = mean(APD, na.rm = TRUE),
            mean_DomPeriod = mean(DPD, na.rm = TRUE),
            mean_wind_dir = mean(WDIR, na.rm = TRUE),
            mean_wind_speed = mean(WSPD, na.rm = TRUE),
            mean_pres = mean(PRES, na.rm = TRUE),
            mean_atmp = mean(ATMP, na.rm = TRUE),
            mean_wtmp = mean(WTMP, na.rm = TRUE))

# by month
summaryMONTH<- swell %>%
  group_by(month(Date_Time)) %>%
  summarise(n = n(),
            mean_wvdir = mean(MWD, na.rm = TRUE),
            mean_wvht = mean(WVHT, na.rm = TRUE),
            mean_AvgPeriod = mean(APD, na.rm = TRUE),
            mean_DomPeriod = mean(DPD, na.rm = TRUE),
            mean_wind_dir = mean(WDIR, na.rm = TRUE),
            mean_wind_speed = mean(WSPD, na.rm = TRUE),
            mean_pres = mean(PRES, na.rm = TRUE),
            mean_atmp = mean(ATMP, na.rm = TRUE),
            mean_wtmp = mean(WTMP, na.rm = TRUE))

```

```{r monthly summary, include = TRUE}
kable(summaryMONTH %>%
  mutate(n = color_tile('light green', 'green')(n)) ,
      row.names = FALSE,
      col.names = c('Month', 'Number of Observations', 'Mean Wave Dir', 'Mean Wave Height', 'Mean APD', 'Mean DPD',
                    'Mean Wind Dir', 'Mean WSPD', 'Mean PRES', 'Mean ATMP', 'Mean WTMP'),
      align = 'c',
      caption = 'Summary Statistics for all Months, NDBC Station 46087',
      escape = FALSE,
  digits = 2) %>%
  column_spec(1:2, bold = TRUE, color = 'black') %>%
  kable_styling(full_width = FALSE)



```


We can see that for the most part there is a consistent number of observations from month to month with the range of 16743 observations for the Month of February, and 21140 observations for the month of October.  There is a lot of information here, and we will use data visualization techniques to explore this further.  For now, consider this aggregation of data by year: 


```{r yearly summary, include=TRUE}
kable(summaryYEAR%>%
  mutate(n = color_tile('yellow', 'green')(n)),
      row.names = FALSE,
      col.names = c('Year', 'Number of Observations', 'Mean Wave Dir', 'Mean Wave Height', 'Mean APD', 'Mean DPD',
                    'Mean Wind Dir', 'Mean WSPD', 'Mean PRES', 'Mean ATMP', 'Mean WTMP'),
      align = 'c',
      caption = 'Summary Statistics for All Years, NDBC Station 46087',
      escape = FALSE,
  digits = 2) %>%
  column_spec(1:2, bold = TRUE, color = 'black') %>%
  kable_styling(full_width = FALSE)

```


Year 2010 is missing altogether.  Also, I notice that year 2004 only has about four thousand observations and year 2013 has about ten thousand.  As we continue with our exploratory data analysis, it will be important to keep in mind that aggregations with less data provide a less accurate picture of what is actually happening during that period of time.  The impact of having twice as much data for a given time period will allow us to glean a more accurate understanding of what is happening.  In other words, be wary not to draw conclusions from comparisons between data aggregations with different levels of clarity (that is, significant differences in numbers of, and distributions of, observations). 

In light of this, let's continue with a look at Monthly Aggregate data for Wave Heights:

```{r monthly agg plot waves, include=TRUE, fig.width=10, fig.height=8, warning=FALSE}
#monthly aggregation plot
summaryMONTH %>%
  ggplot(aes(x = reorder(as.factor(month.abb[.[[1]]]), mean_wvht), y = mean_wvht)) +
  geom_point(alpha = 0.7,
           aes(color = mean_wvdir,
               size = mean_DomPeriod),
           show.legend = TRUE) +
  scale_size(range = c(4, 20)) +
  scale_y_continuous(limits = c(1.25, 2.55)) +
  coord_flip()+
  theme_bw() +
  labs(title = 'Monthly Average Wave Heights',
       subtitle = 'NDBC Station 46087',
       x = 'Month',
       y = 'Mean Wave Height (m)',
       size = 'Mean Dominant Period',
       color = 'Mean Wave Direction (degT)',
       caption = 'Aggregated for all data 2004 to 2019')


```


The months along the y-axis have been arranged in ascending order of average wave height, and values for average wave height appear along the x-axis.  The size of the point corresponds to the average dominant period, while the color corresponds to the average direction for each month. Notice the distinct grouping of winter months between October and April, which tend to have larger average wave heights, larger dominant periods, and a more Southerly direction.  Also notice the distinct group of summer months between May and September, which tend to have smaller average wave heights, smaller dominant periods, and a more Northerly direction.  These seasonal swell patterns are common knowledge, and their presence adds validity to our data.

Consider the following display of the Yearly Aggregated Wave Height data:

```{r yearly agg plot waves, include=TRUE, fig.width=10, fig.height=8, warning=FALSE}
#mean_wvht YEARLY    I LIKE THIS ONE
summaryYEAR %>%
  ggplot(aes(x = as.factor(summaryYEAR[[1]]), 
             y = mean_wvht)) +
  geom_point(alpha = 0.7,
             aes(size = n,
                 color = mean_wvdir),
             show.legend = TRUE) +
  geom_hline(yintercept = mean(summaryYEAR$mean_wvht),
             color = 'palevioletred',
             size = 3,
             alpha = 0.5) +
  geom_text(aes(label = "n ="),
                y = 1.23,
            size = 3,
            show.legend = FALSE) +
  geom_text(aes(label = n),
            y = 1.28,
            size = 3,
            show.legend = TRUE) +
  scale_size(range = c(4, 18)) +
  scale_y_continuous(limits = c(1.25, 2.55)) +
  coord_flip() +
  theme_bw() +
  labs(title = 'Yearly Average Wave Heights',
       subtitle = 'NDBC Station 46087',
       x = 'Year',
       y = 'Mean Wave Height (meters)',
       color = 'Mean Wave Direction (degT)',
       size = 'Number of Observations',
       caption = paste('Aggregated for all data 2004 to 2019 \n\'n\' indicates number of observations\nred line indicates overall average:', round(mean(summaryYEAR$mean_wvht), 2),'m'))

```


The years along the y-axis have been arrange sequentially from 2004 to 2019, and values for average wave height appear along the x-axis.  In this plot, the size of the point corresponds to the number of observations used to generate the aggregate means, while the color represents the average wave direction.  

Now lets take a look at Monthly Aggregated Wind and Weather Data:

```{r monthly agg plot wind/weather, include=TRUE, fig.width=10, fig.height=8, warning=FALSE}
#monthly aggregation plot
summaryMONTH %>%
  ggplot(aes(x = reorder(as.factor(month.abb[.[[1]]]), mean_wind_speed), y = mean_wind_speed)) +
  geom_point(alpha = 0.7,
           aes(color = mean_wind_dir,
               size = mean_pres),
           show.legend = TRUE) +
  scale_size(range = c(10, 20)) +
  #scale_y_continuous(limits = c(1.25, 2.55)) +
  coord_flip()+
  theme_bw() +
  labs(title = 'Monthly Average Wind Speeds',
       subtitle = 'NDBC Station 46087',
       x = 'Month',
       y = 'Mean Wind Speed (m/s)',
       size = 'Mean Atmospheric Pressure (hPa)',
       color = 'Mean Wind Direction (degT)',
       caption = 'Aggregated for all data 2004 to 2019')


```


Here we see months arragned in ascending order of average wind speed along the y-axis and values for average wind speed along the x-axis.  The size of the point corresponds to the atmospheric pressure, while the color of the point corresponds to the average wind direction for each month.  Remember, it's valid to draw conclusions from comparisons is this chart since each month has roughly an equal number of observations.  Again we notice two distinct groups of winter and summer months.  Winter months tend to have lower atmospheric pressure and stronger winds averaging from a more South Easterly direction, while summer months tend to have higher atmospheric pressure and lighter winds averaging from a more South Westerly direction.

Finally let's look at Monthly Aggregated Air and Water Temperatures:

```{r temps, include=TRUE, fig.width=10, fig.height=8, warning=FALSE}
### airtemp and water temp summary plots

#monthly
summaryMONTH %>%
  ggplot(aes(x = reorder(as.factor(month.abb[.[[1]]]), mean_wtmp), 
             y = mean_wtmp)) +
  geom_point(aes(size = mean_wtmp,
                 color = mean_atmp),
             alpha = 0.7,
             show.legend = TRUE) +
  scale_size(range = c(4,18)) +
  coord_flip() +
  theme_gray() +
  labs(title = 'Monthly Average Water Temperature',
       subtitle = 'NDBC Station 46087',
       x = 'Month',
       y = 'Mean Water Temp (deg C)',
       size = 'Mean Water Temp (deg C)',
       color = 'Mean Air Temp (deg C)',
       caption = 'Aggregated for all data 2004 to 2019')
```


Here we see months arranged in ascending order of average water temperature along the y-axis, with values for average water temperature appearing on the x-axis.  There appear to be three major groupings of months, with December through April on the lower end, November and May in the middle, and June through October showing the warmest average water temperatures.  Also, there appears to be a strong positive correllation between mean water temperature and mean air temperature.



## Time Series Exploration

Let's take a different approach and explore this data in a series of yearly plots.  Consider these visualizations of wave data for 2016 through 2019:

```{r yearly waves dir 2016:2019, include=TRUE, fig.width=10, fig.height=8, warning=FALSE}

#create function for feature vs yearly timeseries
plot_timeSeries_yearly_wave <- function(year, y_col, alpha = 0.1, x_col = 'Date_Time'){
    p1 <-swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == year) %>%
      ggplot(aes_string(x = x_col, y = y_col)) +
      geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = dir),
                  alpha = alpha,
                  size = 2) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_light() +
      labs(title = paste('Wave Heights for', year),
           subtitle = 'NDBC Station 46087',
           x = paste('Year ', year),
           y = 'Wave Height (m)',
           color = 'Wave Direction',
           caption = 'Wave Direction by Color') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)))
    
    print(p1)
}

#list of years to display
years <- c(2016:2019)

#plot it for WVHT
years %>% walk(plot_timeSeries_yearly_wave, y_col = 'WVHT')

```


The height of a recorded wave is indicated on the y-axis, with the color of the point representing the direction the wave is coming from.  There is some data missing for part of the spring and early summer of 2017.  In general we see two primary colors, shades of green indicating a more Southwesterly direction and shades of blue indicating a more Northwesterly direction.  Consistent with our previous data aggregations we see larger swell typically occuring during the winter months.


Let's look at the Wind and Pressure data for the same date range:


```{r yearly wind dir 2016:2019, include=TRUE, fig.width=10, fig.height=8, warning=FALSE}

#create function for feature vs yearly timeseries
plot_timeSeries_yearly_wind <- function(year, data, y_col, attr1 = NA, attr2 = NA, alpha = 0.1, x_col = 'Date_Time'){
    p1 <-data %>% 
      na.omit() %>%
      filter(year(Date_Time) > (year - 1) & year(Date_Time) < (year + 1)) %>%
      ggplot(aes_string(x = x_col, y = y_col)) +
      geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes_string(color = attr1),
                  alpha = alpha,
                  size = 2) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_light() +
      labs(title = paste('Wind Speed for', year),
           subtitle = 'NDBC Station 46087',
           x = paste('Year ', year),
           y = 'Wind Speeds (m/s)',
           color = 'Wind Direction',
           caption = 'Wind Direction by Color') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)))
    
    print(p1)
    
}


#list of years to display
years <- c(2016:2019)

#plot it for WVHT
years %>% walk(plot_timeSeries_yearly_wind, data = swell, y_col = 'WSPD', attr1 = 'w_dir')

```


Here the y-axis shows wind speeds in m/s.  The color of the point corresponds to the direction the wind is coming from, and the size corresponds to the pressure at the time of the observation.  The wind directions aren't as cleanly organized as the wave direction data, but we do see trends in winter versus summer months. 


### Diving Deeper with Year 2016

Now let's focus our attention on monthly observations of wave data for year 2016:


```{r 2016 wave data monthly, include=TRUE, fig.width=10, fig.height=8, warning=FALSE}

#create function for feature vs monthly/yearly timeseries
plot_timeSeries_wave <- function(month, year = 2016, data, y_col, attr1 = NA, attr2 = NA, alpha = 0.5, x_col = 'Date_Time'){
  p1 <-data %>% 
      na.omit() %>%
      filter(year(Date_Time) == year & month(Date_Time) == month) %>%
      ggplot(aes_string(x = x_col, y = y_col)) +
    geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes_string(color = attr1,
                             shape = attr2),
                  alpha = alpha,
                  size = 3) +
      scale_shape(drop = FALSE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      scale_y_continuous(breaks = c(1:7)) +
      theme_light() +
      labs(title = paste('Wave Heights for', month.name[month], year),
           subtitle = 'NDBC Station 46087',
           x = paste(month.name[month], year),
           y = 'Wave Height (m)',
           color = 'Wave Direction',
           shape = 'Swell Type',
           caption = 'Wave Direction by Color \nSwell Type by Shape') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)))
    
    print(p1)
}

#list of years to display
months <- c(1:12)

#plot it for WVHT
months %>% walk(plot_timeSeries_wave, data = swell, y_col = 'WVHT', attr1 = 'dir', attr2 = 'swell_type')


```


Each peak on these plots corresponds with a 'swell event'.  It is interesting to note how cleanly organized some of the swell events are, in comparison to the disorganized appearance of others.  I wonder how they relate to concurrent wind data.


Let's find out:


```{r 2016 wind speed each month, include=TRUE, fig.width=10, fig.height=8, warning=FALSE}

#create function for feature vs yearly timeseries
plot_timeSeries_wind <- function(month, year = 2016, data, y_col, attr1 = NA, attr2 = NA, alpha = 0.5, x_col = 'Date_Time'){
    p1 <-data %>%
      na.omit() %>%
      filter(year(Date_Time) == year & month(Date_Time) == month) %>%
      ggplot(aes_string(x = x_col, y = y_col)) +
      geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes_string(color = attr1),
                  alpha = alpha,
                  size = 3) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_light() +
      labs(title = paste('Wind Speed for', month.name[month], year),
           subtitle = 'NDBC Station 46087',
           x = paste(month.name[month], year),
           y = 'Wind Speeds (m/s)',
           caption = '10 m/s is roughly 22.4 MPH',
           color = 'Wind Direction') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)))

    print(p1)
}

#list of years to display
months <- c(1:12)

#plot it for WVHT
months %>% walk(plot_timeSeries_wind, data = swell, y_col = 'WSPD', attr1 = 'w_dir')

```




## Comparing Meteorological and Ocean Current Data

A main objective of this report is to assess meteorological data during known discrepancies between observations and predictions of ocean currents.  For the remainder of this exploration the goal will be to validate the ocean current prediction data by showing that erratic behavior in ocean current observations is visually correllated with major meteorolocial events (large swell, strong winds, etc).  And that the ocean current predictions are a fair and valid representation of how we could expect the ocean current observations to behave in the absence of meteorological events. The underlying motivation for this task is to validate the use of the prediction data in supplying each meteorological observation with a predicted ocean current reading.  This data will be used in developing a supervised machine learning model, and by supplying the model with 'smooth', 'clean' data, as oppossed to the 'erratic', 'noisy' ocean current observations data, we will be able to produce a model which generalizes well and allows for more accuracy in predicting future events.  


Recall from Part 1 these predictions and observations of ocean current for 2016:


```{r, get C_obs data, include = TRUE, warning=FALSE}
setwd( "C:/Users/walke/Documents/Wave Project/Observed Currents NB")

C_obs <- read.csv("currentObs_NB_11_19.csv")

C_obs <- C_obs %>% select(id, date_time, cm_s, degT, dir, depth)

#convert obs$date_time to POSIXct object with timezone in UTC/GMT
C_obs$date_time <- as.character(C_obs$date_time)

C_obs$date_time <- mdy_hm(C_obs$date_time)

C_obs$date_time <- as.POSIXct(C_obs$date_time, tz = 'GMT')

#set ebb to negative cm_s
C_obs$cm_s[C_obs$dir == 'W'] <- C_obs$cm_s[C_obs$dir == 'W'] * -1
```

```{r get C_pred data, include=TRUE, warning=FALSE}
setwd("C:/Users/walke/Documents/Wave Project/Current Predictions NB/Mobile Geographics Data")

C_pred <- read.csv("currentPred_MG_NB_04_21.csv")

C_pred <- C_pred %>% select(id, MoonPhase, Date_Time, Event, cm_s, degT, dir)

#set ebb to negative cm_s
C_pred$cm_s[C_pred$Event == "Ebb"] <- C_pred$cm_s[C_pred$Event == 'Ebb'] * -1

# change pred$Date_Time to POSIXct object
C_pred$Date_Time <- as.character(C_pred$Date_Time)

C_pred$Date_Time <- ymd_hms(C_pred$Date_Time)

C_pred$Date_Time <- as.POSIXct(C_pred$Date_Time, tz = 'GMT')

```

```{r currents 2016, include=TRUE, fig.width=10, fig.height=8}
 C_pred %>%
    filter(year(Date_Time) == 2016 &  Event %in% c('Flood', 'Ebb')) %>%
    ggplot(aes(x = Date_Time, y = cm_s)) +
    geom_point(alpha = 0.3, size = 2, color = 'red') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016),
               aes(x = date_time, y = cm_s),
               alpha = 0.1,
               size = 1,
               color = 'blue') +
    labs(title = "Predicted & Observed Ocean Current",
         subtitle = 'NDBC Station 46087',
         x = 'Year 2016',
         y = 'Speed (cm/s)',
         caption = 'Predicted Slack Events Removed \n100 cm/s is approximately 2.24 MPH')
```


There are four distinct patterns that I notice in this overlay of predictions and observations data.  First, there are periods where the observations are skewed in the positive direction, mainly during the winter months.  Second, there are periods where the predictions and observations appear to line up very well: May and June. Third, there is a period during the summer when the observations appear 'dampened': Between July and September.  Fourth, there are very erratic observations in the 300 cm/s range occuring in the last year of the month.  We will explore all four of these trends.

But first, consider another representation of the same ocean current data for 2016:

```{r currents dir 2016, include=TRUE, fig.width=10, fig.height=8}
 C_pred %>%
    filter(year(Date_Time) == 2016 &  Event %in% c('Flood', 'Ebb')) %>%
    ggplot(aes(x = Date_Time, y = cm_s)) +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(alpha = 0.4, size = 2, color = 'black') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016),
               aes(x = date_time, y = cm_s, color = dir),
               alpha = 0.2,
               size = 1) +
  guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7))) +
    labs(title = "Predicted & Observed Current",
         subtitle = 'NDBC Station 46087',
         x = 'Year 2016',
         color = 'Observed \nDirection',
         caption = 'Predicted Slack Events Removed')
```


In previous analysis we assumed that any current moving other than in a Westerly direction was a flooding current, and should therefore be treated as moving in a positive direction.  Here we have highlighted an important feature, observed direction.  It's important to keep in mind that observed ocean currents don't move in a strict, binary (ebb, flood) pattern as the predicted behavior suggests.  

Also, recall from Part 1 that the source for the predictions data defined the mean predicted ebb direction as 290 deg true, and the mean predicted flood direction as 115 deg true.  Comparing these values to the colors constructed from the observed *dir* field, we must keep in mind that these colors are constructed from a traditional definition of compass points in the N, E, S, and W directions with boundaries at 45 degrees between each compass point.

Let's continue with our exploration to compare meteorological data with this new representation of predicted and observed current patterns.

First, let's focus on February 2016:

```{r current and meteorological February 2016, include=TRUE, fig.width=10, fig.height=18, warning=FALSE}

a <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) %in% 2) %>%
      ggplot(aes(x = Date_Time, y = WVHT)) +
  geom_rect(aes(xmin = as.POSIXct('2016-02-02 12:00:00'), xmax = as.POSIXct('2016-02-07 23:00:00'),
                ymin = -0.25, ymax = 5.2),
            alpha = 0.1,
            fill = 'ivory',
            color = 'grey2') +
  geom_rect(aes(xmin = as.POSIXct('2016-02-18 12:00:00'), xmax = as.POSIXct('2016-02-22 13:00:00'),
                ymin = -0.25, ymax = 4.75),
            alpha = 0.1,
            fill = 'azure',
            color = 'grey2') +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
  geom_jitter(aes(color = dir,
                      shape = swell_type),
                  alpha = 0.3,
                  size = 3,
                  show.legend = TRUE) +
  scale_color_hue(labels = levels,
                         drop = FALSE) +
  theme_gray() +
  labs(title = 'Wave Heights',
           subtitle = 'NDBC Station 46087',
           x = 'February 2016',
           y = 'Wave Height (m)',
           color = 'Wave \nDirection',
           shape = 'Swell Type') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)),
         shape = guide_legend(override.aes = list(size = 5, alpha = 0.3)))
  
b <- NA

c <- C_pred %>%
    filter(year(Date_Time) == 2016 & month(Date_Time) %in% 2 &  Event %in% c('Flood', 'Ebb')) %>%
  ggplot(aes(x = Date_Time, y = cm_s)) +
  geom_rect(aes(xmin = as.POSIXct('2016-02-02 12:00:00'), xmax = as.POSIXct('2016-02-07 23:00:00'),
                ymin = -110, ymax = 140),
            alpha = 0.1,
            fill = 'ivory',
            color = 'grey2') +
  geom_rect(aes(xmin = as.POSIXct('2016-02-18 12:00:00'), xmax = as.POSIXct('2016-02-22 13:00:00'),
                ymin = -110, ymax = 160),
            alpha = 0.1,
            fill = 'azure',
            color = 'grey2') +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(alpha = 0.4, size = 3, color = 'black') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016 & month(date_time) %in% 2),
               aes(x = date_time, y = cm_s, color = dir),
               alpha = 0.3,
               size = 2) +
  guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7))) +
    labs(title = 'Predicted & Observed Current',
         subtitle = 'NDBC Station 46087',
         x = 'February 2016',
         y = 'Speed (cm/s)',
         color = 'Observed \nDirection',
         caption = 'Predicted Slack Events Removed') +
  theme(legend.position = 'bottom') 


grid.arrange(c, a, ncol = 1)


```


Notice the 'swell events', which are somewhat aligned with the erratic current observations.  Swell events from a more Southerly direction seem to align with positive current readings moving in a more Northerly direction.  Likewise, swell events from a more Westerly direction seem to align with positive current readings moving in a more Easterly direction.


Let's zoom in on February 1st to 8th, 2016:

```{r current and meteorological February 1-8nd 2016, include=TRUE, fig.width=10, fig.height=18, warning=FALSE}

a <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) == 2 & day(Date_Time) %in% c(1:8)) %>%
      ggplot(aes(x = Date_Time, y = WVHT)) +
      geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = dir,
                      shape = swell_type),
                  alpha = 0.5,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wave Heights',
           subtitle = 'NDBC Station 46087',
           x = 'February 1st to 8th, 2016',
           y = 'Wave Height (m)',
           color = 'Wave \nDirection',
           shape = 'Swell Type') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)),
         shape = guide_legend(override.aes = list(size = 5, alpha = 0.3)))
  
b <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) == 2 & day(Date_Time) %in% c(1:8)) %>%
      ggplot(aes(x = Date_Time, y = WSPD)) +
      geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = w_dir),
                  size = 3,
                  alpha = 0.5,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wind Speeds',
           subtitle = 'NDBC Station 46087',
           x = 'February 1st to 8th, 2016',
           y = 'Wind Speed (m/s)',
           color = 'Wind \nDirection',
           caption = '10 m/s is approximately 22.4 MPH') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)))

c <- C_pred %>%
    filter(year(Date_Time) == 2016 & month(Date_Time) %in% 2 & day(Date_Time) %in% c(1:8) & Event %in% c('Flood', 'Ebb')) %>%
    ggplot(aes(x = Date_Time, y = cm_s)) +
    geom_point(alpha = 0.3, size = 3, color = 'black') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016 & month(date_time) %in% 2 & day(date_time) %in% c(1:8)),
               aes(x = date_time, y = cm_s, color = dir),
               alpha = 0.3,
               size = 2) +
  guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7))) +
    labs(title = "Predicted & Observed Current",
         subtitle = 'NDBC Station 46087',
         x = 'February 1st to 8th, 2016',
         y = 'Speed (cm/s)',
         color = 'Observed \nDirection',
         caption = 'Predicted Slack Events Removed,\n 100 cm/s is approximately 2.24 MPH') +
  theme(legend.position = 'bottom') 


grid.arrange(c, a, b, ncol = 1)


```


Let's take a minute to highlihgt some important considerations:

Typical predicted peak current speeds rarely exceed the range from -100 to 50 cm/s, where 100 cm/s is approximately equal to 2.24 MPH, or 1.94 knts.

There is an important distinction regarding the 'direction' description of wind and waves as opposed to ocean current.  Wind and wave directions are referenced as the direction that they are coming from, while ocean current directions are described as the direction to which they are moving.

When comparing the timelines of these meteorological recordings and those of the ocean current observations it is important to remember that the swell recordings are aggregated readings from a "20-minute sample period" within the previous 30 minutes, while ocean current observations are observations of what is happening aggregated over a much shorter period of time.  Review the NDBC Measurement Descriptions [webpage](https://www.ndbc.noaa.gov/measdes.shtml) for further details.

Another important consideration is the speed at which swell trains and individual waves travel, which affects the potential for energy transfer as a function of wave density.  "The speed (in nautical miles per hour or kts) of an individual deep water wave is about 3 times it's period (in seconds). That is, an individual wave with a 13 second period travels at 39 kts. Contrary to what you might intuitively think, there is a linear relationship between wave period and wave speed. But because most deep water waves move in groups, the group speed is half that of an individual wave (within the group), or in this example about 19.5 kts. As the wave moves into shallow water, the group speed and the individual wave speed become the same, so the individual wave starts traveling at the group speed, or 19.5 kts. This wave speed formula is approximate, and actually wave speeds are a fraction different," as this [website](http://www.stormsurf.com/page2/tutorials/wavebasics.shtml) describes.  I highly recommend spending a few minutes to read through that website, it covers a significant amount of pertinent information, like wave density, which we will forego for the purposes of this report.

If we walk through the timeline of ocean currents from the 1st to the 8th of February, 2016, we notice that the predicted range of currents start out approximately between -75 and 25, and builds in magnitude through the 8th where it ranges from -100 to 75.  Observations of ocean currents tend to remain in the positive, or flood direction for the majority of the period, following the ebb predictions only during the strongest peak-ebb events.  There are also three 'spikes' in the positive direction for observed ocean currents.  These occur on February 3rd, 4th, and 5th/6th, corresponding to powerful groundswell events in the 10 to 15ft range with a period of 14 to 18 seconds. 


Moving on let's shift our attention to April 2016:

```{r current and meteorological April 2016, include=TRUE, fig.width=10, fig.height=18, warning=FALSE}

a <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) %in% 4) %>%
      ggplot(aes(x = Date_Time, y = WVHT)) +
      geom_rect(aes(xmin = as.POSIXct('2016-04-12 12:00:00'), xmax = as.POSIXct('2016-04-17 00:00:00'),
                ymin = -0.25, ymax = 4.5),
            alpha = 0.1,
            fill = 'ivory',
            color = 'grey2') +  
  geom_rect(aes(xmin = as.POSIXct('2016-04-22 00:00:00'), xmax = as.POSIXct('2016-04-26 00:00:00'),
                ymin = -0.25, ymax = 4.5),
            alpha = 0.1,
            fill = 'azure',
            color = 'grey2') +  
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = dir,
                      shape = swell_type),
                  alpha = 0.3,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wave Heights',
           subtitle = 'NDBC Station 46087',
           x = 'April 2016',
           y = 'Wave Height (m)',
           color = 'Wave \nDirection',
           shape = 'Swell Type') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)),
         shape = guide_legend(override.aes = list(size = 5, alpha = 0.3)))
  
b <- NA

c <- C_pred %>%
    filter(year(Date_Time) == 2016 & month(Date_Time) %in% 4 &  Event %in% c('Flood', 'Ebb')) %>%
    ggplot(aes(x = Date_Time, y = cm_s)) +
  geom_rect(aes(xmin = as.POSIXct('2016-04-12 12:00:00'), xmax = as.POSIXct('2016-04-17 00:00:00'),
                ymin = -110, ymax = 95),
            alpha = 0.1,
            fill = 'ivory',
            color = 'grey2') +  
  geom_rect(aes(xmin = as.POSIXct('2016-04-22 00:00:00'), xmax = as.POSIXct('2016-04-26 00:00:00'),
                ymin = -115, ymax = 155),
            alpha = 0.1,
            fill = 'azure',
            color = 'grey2') +  
    geom_point(alpha = 0.4, size = 3, color = 'black') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016 & month(date_time) %in% 4),
               aes(x = date_time, y = cm_s, color = dir),
               alpha = 0.3,
               size = 2) +
  guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7))) +
    labs(title = "Predicted & Observed Current",
         subtitle = 'NDBC Station 46087',
         x = 'April 2016',
         y = 'Speed (cm/s)',
         color = 'Observed \nDirection',
         caption = 'Predicted Slack Events Removed') +
  theme(legend.position = 'bottom') 


grid.arrange(c, a, ncol = 1)


```


April is an interesting example, showing two main periods of discrepancies between ocean current predictions and observations.  The first half of the month shows a strong series of predicted current exchanges with a maximum range of about -120 to 70 around April 10th.  The second half of the month shows a smaller magnitude in predicted current exchanges, as well as a larger discrepancy in ocean current predictions and observations.

Let's focus our attention on April 21st to 26th, 2016:


```{r current and meteorological April 21-26nd 2016, include=TRUE, fig.width=10, fig.height=18, warning=FALSE}

a <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) == 4 & day(Date_Time) %in% c(21:26)) %>%
      ggplot(aes(x = Date_Time, y = WVHT)) +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = dir,
                      shape = swell_type),
                  alpha = 0.5,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wave Heights',
           subtitle = 'NDBC Station 46087',
           x = 'April 21st to 26th, 2016',
           y = 'Wave Height (m)',
           color = 'Wave\nDirection',
           shape = 'Swell Type') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)),
         shape = guide_legend(override.aes = list(size = 5, alpha = 0.3)))
  
b <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) == 4 & day(Date_Time) %in% c(21:26)) %>%
      ggplot(aes(x = Date_Time, y = WSPD)) +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = w_dir),
                  alpha = 0.5,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wind Speeds',
           subtitle = 'NDBC 46087',
           x = 'April 21st to 26th, 2016',
           y = 'Wind Speed (m/s)',
           color = 'Wind \nDirection',
           caption = '10 m/s is approximately 22.4 MPH') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)))

c <- C_pred %>%
    filter(year(Date_Time) == 2016 & month(Date_Time) %in% 4 & day(Date_Time) %in% c(21:26) & Event %in% c('Flood', 'Ebb')) %>%
    ggplot(aes(x = Date_Time, y = cm_s)) +
    geom_point(alpha = 0.3, size = 3, color = 'black') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016 & month(date_time) %in% 4 & day(date_time) %in% c(21:26)),
               aes(x = date_time, y = cm_s, color = dir),
               alpha = 0.3,
               size = 2) +
  guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7))) +
    labs(title = "Predicted & Observed Current",
         subtitle = 'NDBC Station 46087',
         x = 'April 21st to 26th, 2016',
         y = 'Speed (cm/s)',
         color = 'Observed \nDirection',
         caption = 'Predicted Slack Events Removed,\n 100 cm/s is approximately 2.24 MPH') +
  theme(legend.position = 'bottom') 


grid.arrange(c, a, b, ncol = 1)


```


Notice the combination of Southerly winds and Southwest swell on April 23rd, and observed current readings mixed between North and East.  Also, notice the combination of Northwest wind and Northwest swell on April 25th, and observed current readings moving in a Southerly direction.


Moving on, let's explore May 2016:

```{r current and meteorological May 2016, include=TRUE, fig.width=10, fig.height=18, warning=FALSE}

a <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) %in% 5) %>%
      ggplot(aes(x = Date_Time, y = WVHT)) +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = dir,
                      shape = swell_type),
                  alpha = 0.3,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wave Heights',
           subtitle = 'NDBC Station 46087',
           x = 'May 2016',
           y = 'Wave Height (m)',
           color = 'Wave \nDirection',
           shape = 'Swell Type') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)),
         shape = guide_legend(override.aes = list(size = 5, alpha = 0.3)))
  
b <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) == 5) %>%
      ggplot(aes(x = Date_Time, y = WSPD)) +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = w_dir),
                  alpha = 0.5,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wind Speeds',
           subtitle = 'NDBC Station 46087',
           x = 'May 2016',
           y = 'Wind Speed (m/s)',
           color = 'Wind \nDirection',
           caption = '10 m/s is approximately 22.4 MPH') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)))


c <- C_pred %>%
    filter(year(Date_Time) == 2016 & month(Date_Time) %in% 5 &  Event %in% c('Flood', 'Ebb')) %>%
    ggplot(aes(x = Date_Time, y = cm_s)) +
    geom_point(alpha = 0.4, size = 3, color = 'black') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016 & month(date_time) %in% 5),
               aes(x = date_time, y = cm_s, color = dir),
               alpha = 0.3,
               size = 2) +
  guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7))) +
    labs(title = "Predicted & Observed Current",
         subtitle = 'NDBC Station 46087',
         x = 'May 2016',
         y = 'Speed (cm/s)',
         color = 'Observed \nDirection',
         caption = 'Predicted Slack Events Removed \n100 cm/s is approximately 2.24 MPH') +
  theme(legend.position = 'bottom') 


grid.arrange(c, a, b, ncol = 1)


```


There are two medium sized swell events occuring around May 8th to 9th and 18th to 21st.  The initial period of the month, with larger current exchanges and a more Northerly swell event, shows observed ocean current observations with a more southerly direction.  The second period of the month, with a slightly smaller current exchange and a more Southerly swell event, shows observed ocean current observations with a more Notherly reading.  Notice also, that the first swell event has a shorter period, and therefore less density, than the second swell event.


Moving Forward, let's look at July 2016:


```{r current and meteorological July 2016, include=TRUE, fig.width=10, fig.height=18, warning=FALSE}

a <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) %in% 7) %>%
      ggplot(aes(x = Date_Time, y = WVHT)) +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = dir,
                      shape = swell_type),
                  alpha = 0.3,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wave Heights',
           subtitle = 'NDBC Station 46087',
           x = 'July 2016',
           y = 'Wave Height (m)',
           color = 'Wave \nDirection',
           shape = 'Swell Type') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)),
         shape = guide_legend(override.aes = list(size = 5, alpha = 0.3)))
  
b <- NA

c <- C_pred %>%
    filter(year(Date_Time) == 2016 & month(Date_Time) %in% 7 &  Event %in% c('Flood', 'Ebb')) %>%
    ggplot(aes(x = Date_Time, y = cm_s)) +
    geom_point(alpha = 0.4, size = 3, color = 'black') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016 & month(date_time) %in% 7),
               aes(x = date_time, y = cm_s, color = dir),
               alpha = 0.3,
               size = 2) +
  guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7))) +
    labs(title = "Predicted & Observed Current",
         subtitle = 'NDBC Station 46087',
         x = 'July 2016',
         y = 'Speed (cm/s)',
         color = 'Observed \nDirection',
         caption = 'Predicted Slack Events Removed \n100 cm/s is approximately 2.24 MPH') +
  theme(legend.position = 'bottom') 


grid.arrange(c, a, ncol = 1)


```


What is happening here?  Why are the ocean current observations so dampened?  

Consider the aggregate mean water temperatures for all years compared with mean water temperatures for 2016:

```{r mean aggregate water temp, include=TRUE}

  
  kable(cbind(summaryMONTH %>% select(`month(Date_Time)`, mean_atmp, mean_wtmp) %>%
                mutate(mean_wtmp = color_tile('yellow', 'orange')(mean_wtmp)),
              swell %>%
                na.omit() %>%
                filter(year(Date_Time) == 2016) %>%
                group_by(month(Date_Time)) %>%
                summarise(mean_atmp16 = mean(ATMP),
                          mean_wtmp16 = mean(WTMP)) %>%
                select(mean_atmp16, mean_wtmp16)) %>%
          mutate(mean_wtmp16 = color_tile('yellow', 'red')(mean_wtmp16)),
        row.names = FALSE,
        col.names = c('Month', 'Mean ATMP<br/>(All Years)', 'Mean WTMP<br/>(All Years)', 'Mean ATMP<br/>(2016)', 'Mean WTMP<br/>(2016)' ),
        align = 'c',
        caption = 'Summary Statistics for Given Month, NDBC Station 46087, Temperatures in Degrees Celsius',
        escape = FALSE,
        digits = 2) %>%
  column_spec(column = c(1, 3, 5), bold = TRUE) %>%
  kable_styling(full_width = FALSE)


```


And here a visualization showing the differences in mean water temperatures for 2016 as compared to aggregate mean water temperature for all years:

```{r visual mean agg water temp, include=TRUE, fig.width=10, fig.height=8, warning=FALSE}

summaryMONTH %>% select(`month(Date_Time)`, mean_wtmp, mean_atmp) %>%
  ggplot(aes(x = `month(Date_Time)`, y = mean_wtmp)) +
  geom_line(color = 'blue',
            size = 3,
            alpha = 0.5) +
  geom_line(data = swell %>%
                na.omit() %>%
                filter(year(Date_Time) == 2016) %>%
                group_by(month(Date_Time)) %>%
                summarise(mean_atmp = mean(ATMP),
                          mean_wtmp = mean(WTMP)) %>%
                select(`month(Date_Time)`, mean_wtmp),
            aes(x = `month(Date_Time)`, y = mean_wtmp),
            size = 3,
            color = 'red',
            alpha = 0.5) +
  scale_x_continuous(breaks = c(1:12),
                     labels = month.name) +
  labs(title = 'Monthly Mean Water Temperature',
       subtitle = 'NDBC Station 46087 \nYear 2016 in Red \nAggregate Data for All Years in Blue',
       y = 'Mean Water Temperature (deg C)',
       x = 'Month')


```


As we can see, water temperatures for 2016 were well above normal.

I believe the elevated water temperatures during the early part of 2016 led to an increase of marine growth for the summer months.  In particular, this increase of marine growth may have fouled the Aanderaa Doppler Current Sensor (ADCS) instrumentation attached at a depth of 1.6 meters to the NDBC Station 46087, leading to the 'dampened' effect of ocean current observations.  Even with an anti-fouling coating and routine maintenance, a permanent ocean fixture could easily become covered in marine growth during the peak of the season exacerbated by higher than average water temperatures. NOAA describes their 'Data Quality Control Checks and Procedures' in this [pdf document](https://www.nodc.noaa.gov/archive/arc0056/0070493/2.2/data/0-data/NDBCHandbookofAutomatedDataQualityControl2009.pdf), with relevant ocean current quality control definitions beginning on page 25.  Anyone who has left a boat in the ocean through the summer months understands how quickly this plant, barnacle and mussel growth can accumulate.  For those not familiar with this phenomenom a quick search engine query will provide [examples](https://duckduckgo.com/?q=marine+growth&t=ffab&iar=images&iax=images&ia=images).   


Let's examine the last month of the year, December 2016:

```{r current and meteorological Dec 2016, include=TRUE, fig.width=10, fig.height=18, warning=FALSE}
a <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) %in% 12) %>%
      ggplot(aes(x = Date_Time, y = WVHT)) +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = dir,
                      shape = swell_type),
                  alpha = 0.3,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wave Heights',
           subtitle = 'NDBC Station 46087',
           x = 'December 2016',
           y = 'Wave Height (m)',
           color = 'Wave \nDirection',
           shape = 'Swell Type') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)),
         shape = guide_legend(override.aes = list(size = 5, alpha = 0.3)))
  
b <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) == 12) %>%
      ggplot(aes(x = Date_Time, y = WSPD)) +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
      geom_jitter(aes(color = w_dir),
                  alpha = 0.5,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wind Speeds',
           subtitle = 'NDBC Station 46087',
           x = 'December 2016',
           y = 'Wind Speed (m/s)',
           caption = '10 m/s is approximately 22.4 MPH',
           color = 'Wind \nDirection') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)))

c <- C_pred %>%
    filter(year(Date_Time) == 2016 & month(Date_Time) %in% 12 & Event %in% c('Flood', 'Ebb')) %>%
    ggplot(aes(x = Date_Time, y = cm_s)) +
  geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(alpha = 0.4, size = 3, color = 'black', fill = 'red') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016 & month(date_time) %in% 12),
               aes(x = date_time, y = cm_s, color = dir),
               alpha = 0.3,
               size = 2) +
  guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7))) +
    labs(title = "Predicted & Observed Current",
         subtitle = 'NDBC Station 46087',
         x = 'December 2016',
         y = 'Speed (cm/s)',
         color = 'Observed \nDirection',
         caption = 'Predicted Slack Events Removed \n100 cm/s is approximately 2.24 MPH') +
  theme(legend.position = 'bottom') 


grid.arrange(c, a, b, ncol = 1)


```

 

Let's focus on the erratic behavior of the observed ocean current between the 17th and 19th of December:



```{r current and meteorological December 17-19 2016, include=TRUE, fig.width=10, fig.height=18, warning=FALSE}

a <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) == 12 & day(Date_Time) %in% c(17:19)) %>%
      ggplot(aes(x = Date_Time, y = WVHT)) +
      geom_jitter(aes(color = dir,
                      shape = swell_type),
                  alpha = 0.5,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wave Heights',
           subtitle = 'NDBC Station 46087',
           x = 'December 17th to 19th, 2016',
           y = 'Wave Height (m)',
           color = 'Wave\nDirection',
           shape = 'Swell Type') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)),
         shape = guide_legend(override.aes = list(size = 5, alpha = 0.3)))
  
b <- swell %>% 
      na.omit() %>%
      filter(year(Date_Time) == 2016 & month(Date_Time) == 12 & day(Date_Time) %in% c(17:19)) %>%
      ggplot(aes(x = Date_Time, y = WSPD)) +
      geom_jitter(aes(color = w_dir),
                  alpha = 0.5,
                  size = 3,
                  show.legend = TRUE) +
      scale_color_hue(labels = levels,
                         drop = FALSE) +
      theme_gray() +
      labs(title = 'Wind Speeds',
           subtitle = 'NDBC Station 46087',
           x = 'December 17th to 19th, 2016',
           y = 'Wind Speed (m/s)',
           color = 'Wind \nDirection',
           caption = '10 m/s is approximately 22.4 MPH') +
  theme(legend.position = 'bottom') +
      guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7)))

c <- C_pred %>%
    filter(year(Date_Time) == 2016 & month(Date_Time) %in% 12 & day(Date_Time) %in% c(17:19) & Event %in% c('Flood', 'Ebb')) %>%
    ggplot(aes(x = Date_Time, y = cm_s)) +
    geom_point(alpha = 0.3, size = 3, color = 'black') +
    geom_line(color = 'grey', size = 0.5, alpha = 0.5) +
    geom_hline(yintercept = 0,
                   color = 'grey',
                   size = 2,
                   alpha = .7) +
    geom_point(data = C_obs %>%
                 filter(year(date_time) == 2016 & month(date_time) %in% 12 & day(date_time) %in% c(17:19)),
               aes(x = date_time, y = cm_s, color = dir),
               alpha = 0.3,
               size = 2) +
  guides(color = guide_legend(override.aes = list(size = 5, alpha = 0.7))) +
    labs(title = "Predicted & Observed Current",
         subtitle = 'NDBC Station 46087',
         x = 'December 17th to 20th, 2016',
         y = 'Speed (cm/s)',
         color = 'Observed \nDirection',
         caption = 'Predicted Slack Events Removed,\n 100 cm/s is approximately 2.24 MPH') +
  theme(legend.position = 'bottom') 


grid.arrange(c, a, b, ncol = 1)


```


I do not notice an apparent correlation between meteorological events and these extremely erratic oberserved current readings.  However, I do notice that there is an increase in Northerly observed ocean current readings as the large swell event from the Southwest fills in and peaks on December 19th.




# Summary, Conclusions, and Next Steps

We have explored aggregate meteorological and swell data from years 2004 to 2019, and confirmed the presence of anticipated trends along seasonal boundaries in wind speed and direction, as well as wave height, direction, and period.  We have explored this data on a granular level, and examined correllations (not necessarily causations) in swell events with discrepancies between ocean current predictions and observations.  We have explored the presence of unusually warm water temperatures during 2016, and made conjectures regarding 'dampened' ocean current observation recordings.  And finally, we have explored unusually erratic ocean current observations and did not find any correllation with meteorological events.

In examining these occurrences of deviation between predicted and observed ocean currents, I have shown correllation with strong swell events; I have shown adherence to predicted flows during strong current exchanges; I have conjectured regarding correllation with potential algeal growth interferrence; and ultimately, I have shown that the ocean current prediction data is a valid baseline upon which we could expect to observe ocean currents in the absence of interferring factors (noise: meteorological events, marine growth, data transmission errors, etc).  In conclusion, I feel validated in moving forward with utilizing the ocean current predictions data in a supervised machine learning model.

In part 3 of this project we will explore data from the NDBC Station 46088, also known as the New Dungeness Buoy, located at the East entrance to the Strait of Juan de Fuca.  Our intent will be to explore meteorological data from this station to determine a list of dates on which swell was recorded travelling through the strait.  We will use this list of dates to explore ocean current and meteorological data at the Neah Bay Buoy, NDBC Station 46087, and look for trends in conditions.  This will lead us to part 4 of the *Exploring Ocean Buoy Data* project, where we will explore features through statistical analysis to help us train a supervised machine learning model to predict the class of wave occuring at the New Dungeness Buoy, given forecasted conditions at the Neah Bay Buoy. 



## Appendix

### Data Definitions
**Summary of Meteorological Data:**

```{r summary data, include=TRUE}
summary(swell)
```

**Glimpse of Meteorological Data:**

```{r glimpse data, include=TRUE}
glimpse(swell)
```


Here we will walk through a definition and short description for each field:

- **id** indicates the location. NDBC Station ID 46087 refers to the Neah Bay Buoy.
- **Date_Time**  is the year, month, day, and time of the recorded observation.  Observations are recorded twice hourly then stored in GMT/UTC timezone by the NDBC.
- **WVHT** is defined by the NDBC website as, "Significant wave height (meters) is calculated as the average of the highest one-third of all of the wave heights during the 20-minute sampling period."
- **MWD** is defined by the NDBC website as, "The direction from which the waves at the dominant period (DPD) are coming. The units are degrees from true North, increasing clockwise, with North as 0 (zero) degrees and East as 90 degrees."
- **dir** is a feature I engineered using the data from *MWD*.  Values follow the standard notation for cardinal direction, more information on cardinal direction can be found [here](https://en.wikipedia.org/wiki/Cardinal_direction).
- **swell_type** is a feature I engineered using *DPD*.  Values indicate whether a given observation is classified as 'groundswell', having a dominant wave period of greater than or equal to 13 seconds, or 'windswell', having a dominant wave period of less than 13 seconds but greater than or equal to 10 seconds, or 'windwave', having a dominant period less than 10 seconds but greater than 4 seconds, or 'chop', having a dominant period 4 seconds or smaller, or 'flat', having dominant period equal to 0 with a wave height of 0.  For more information on swell mechanics see this [website](https://en.wikipedia.org/wiki/Swell_(ocean)).
- **DPD** is defined by the NDBC website as, "Dominant wave period (seconds) is the period with the maximum wave energy."
- **APD** is defined by the NDBC website as, "Average wave period (seconds) of all waves during the 20-minute period."
- **WDIR** is defined by the NDBC website as, "Wind direction (the direction the wind is coming from in degrees clockwise from true N) during the same period used for WSPD."
- **w_dir** is a feature I engineered using the datat from *WDIR* and the same value definitions as *dir*.
- **WSPD** is defined by the NDBC website as, "Wind speed (m/s) averaged over an eight-minute period for buoys."
- **GST** is defined by the NDBC website as, "Peak 5 or 8 second gust speed (m/s) measured during the eight-minute or two-minute period. The 5 or 8 second period can be determined by payload."
- **PRES** is defined by the NDBC website as, "Sea level pressure (hPa)."
- **ATMP** is defined by the NDBC website as, "Air temperature (Celsius)."
- **WTMP** is defined by the NDBC website as, "Sea surface temperature (Celsius). For buoys the depth is referenced to the hull's waterline."
- **DEWP** is defined by the NDBC website as, "Dewpoint temperature taken at the same height as the air temperature measurement."

Further details regarding measurement techniques utilized by the NDBC can be found [here](https://www.ndbc.noaa.gov/measdes.shtml).




### References 

- https://www.ndbc.noaa.gov/
- https://www.ndbc.noaa.gov/station_page.php?station=46087
- https://en.wikipedia.org/wiki/Cardinal_direction
- https://en.wikipedia.org/wiki/Swell_(ocean)
- https://www.ndbc.noaa.gov/measdes.shtml
- http://www.stormsurf.com/page2/tutorials/wavebasics.shtml
- https://www.ndbc.noaa.gov/measdes.shtml
- https://www.nodc.noaa.gov/archive/arc0056/0070493/2.2/data/0-data/NDBCHandbookofAutomatedDataQualityControl2009.pdf
- https://duckduckgo.com/?q=marine+growth&t=ffab&iar=images&iax=images&ia=images
